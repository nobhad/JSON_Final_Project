<!-- 
  File: /views/testimonials/new.ejs
  Purpose: Form for registered users to submit testimonials with WYSIWYG editor and image upload
  Notes:
  - Uses the main layout partial `views/partials/layout.ejs`
  - Expects optional `success` and `error` messages passed in from controller
-->

<main>
  <h1>Submit a Testimonial</h1>

  <% if (typeof success !== 'undefined') { %>
    <p style="color: green;"><%= success %></p>
  <% } %>

  <% if (typeof error !== 'undefined') { %>
    <p style="color: red;"><%= error %></p>
  <% } %>

  <form id="testimonialForm" action="/testimonials" method="POST" enctype="multipart/form-data">
    <div>
      <label for="content">Your Testimonial:</label><br/>
      <textarea id="content" name="content"></textarea>
    </div>
    <br/>

    <div>
      <label for="image">Upload an image:</label><br/>
      <input type="file" id="image" name="image" accept="image/*" />
    </div>
    <br/>

    <button type="submit">Submit</button>
  </form>
</main>

<script src="https://cdn.tiny.cloud/1/57xs9zln2l3k3vne020995s72wpqckdnddn1lfue9nm97too/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

<script>
  tinymce.init({
    selector: '#content',
    setup: function (editor) {
      const form = document.getElementById('testimonialForm');

      form.addEventListener('submit', function (e) {
        editor.save();
        const content = editor.getContent({ format: 'text' }).trim();

        if (!content) {
          e.preventDefault();
          alert('Please enter a testimonial before submitting.');
        }
      });
    }
  });
</script>
