<!--
  File: /views/testimonials/edit.ejs
  Purpose: For editing or deleting an existing testimonial
-->

<main>
  <h1>Edit Testimonial</h1>

  <form id="testimonialForm" action="/testimonials/edit/<%= testimonial._id %>" method="POST" enctype="multipart/form-data">
    <div>
      <label for="content">Your Testimonial:</label><br/>
      <textarea id="content" name="content" required><%= testimonial.content %></textarea>
    </div>
    <br/>

    <div>
      <label for="image">Update image (optional):</label><br/>
      <input type="file" id="image" name="image" accept="image/*" />
    </div>
    <br/>

    <button type="submit">Update</button>
  </form>

  <form action="/testimonials/delete/<%= testimonial._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this testimonial?');">
    <button type="submit" style="margin-top:1em; background-color: red; color: white;">Delete</button>
  </form>

  <br/>
  <a href="/dashboard">Cancel</a>
</main>

<script src="https://cdn.tiny.cloud/1/57xs9zln2l3k3vne020995s72wpqckdnddn1lfue9nm97too/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

<script>
  tinymce.init({
    selector: '#content',
    setup: function (editor) {
      const form = document.getElementById('testimonialForm');

      form.addEventListener('submit', function (e) {
        editor.save();
        const content = editor.getContent({ format: 'text' }).trim();

        if (!content) {
          e.preventDefault();
          alert('Please enter a testimonial before submitting.');
        }
      });
    }
  });
</script>
